@model Cashed.View.Models.ProductListViewModel
@{
    ViewBag.Title = "Продукты";
}

<div class="container">
    <div class="row">
        <div class="form-group row">
            <label class="col-form-label col-md-3" for="datepicker">Категория</label>
            @*@Html.TextBoxFor(m => m.DateTime, new { @class = "form-control" })*@
            <input id="Category" type="text" class="form-control" list="categoryList"/>
            <div class="col-md-2">
                <span class="input-icon input-group-addon" id="search-button">
                    <i class="fa fa-search"></i>
                </span>
            </div>
            <datalist id="categoryList">
                @foreach (var category in Model.Categories)
                {
                    <option>@category.Name</option>
                }
            </datalist>
        </div>
    </div>
</div>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th class="checkbox-cell" hidden>
                <input type="checkbox" class="toggle-all-chechboxes" />
            </th>
            <th>
                Номер
            </th>
            <th>
                Название
            </th>
        </tr>
    </thead>
    <tbody id="Products">
        <tr data-id="1">
            <td class="checkbox-cell" hidden>
                <input type="checkbox" class="category-checkbox" data-id="1" />
            </td>
            <td>1</td>
            <td>
                @*@Html.ActionLink(Model[i].Name, "Edit", new { id = Model[i].Id }, new { @class = "edit-item-link" })*@
                Телевизор
            </td>
        </tr>
    </tbody>
</table>
@Html.ActionLink("Добавить", "Add", "Products", null,
    new { id = "categoriesLink", @class = "btn btn-outline-primary btn-sm" })

@section Scripts 
{
    <script type="text/javascript">
        activateLink("#productsLink");

        makeInputAutocomplete("Category", null, categorySelected, "col-md-7");

        function categorySelected() {
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetProducts", "Products")',
                contentType: "application/json; charset=utf-8",
                data: { categoryName: $("#Category").val() },
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    updateProducts(data);
                },
                error: function () { alert('Server failure!'); }
            });
        }

        function updateProducts(products) {
            var table = $("#Products");
            table.empty();
            for (var i = 0; i < products.length; i++) {
                $('<tr>')
                    .append( $('<td>').html(
                        products[i].Id
                    ) )
                    .append( $('<td>').html(
                        products[i].Name
                    ) )
                    .appendTo(table);
            }
        }

    </script>
}

